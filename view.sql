CREATE VIEW `view_order` AS select `o`.`id` AS `id`, `o`.`supplier` as `supplier`,`o`.`date` AS `date`,`c`.`name` AS `name`,`u`.`givenname` AS `givenname`,`u`.`surname` AS `surname`,((coalesce((select sum((`x`.`quantity_kg` * `x`.`price`)) from (`order_item` `z` join (`order_subitem` `x` join `color` `y` on(((`y`.`id` = `x`.`id_color`) and ((`y`.`color_type` = 2) or (`y`.`color_type` = 3)))))) where ((`x`.`id_order` = `o`.`id`) and (`z`.`id_order` = `x`.`id_order`) and (`x`.`id_product` = `z`.`id_product`))),0) + coalesce((select sum(((`x`.`quantity_kg` * `x`.`price`) * `z`.`quantity`)) from (`order_item` `z` join (`order_subitem` `x` join `color` `y` on(((`y`.`id` = `x`.`id_color`) and (`y`.`color_type` = 1))))) where ((`x`.`id_order` = `o`.`id`) and (`z`.`id_order` = `x`.`id_order`) and (`x`.`id_product` = `z`.`id_product`))),0)) + coalesce((select coalesce(sum((`z`.`quantity` * `z`.`price`)),0) from (`order_item` `z` join `product` `p`) where ((`p`.`recipe` = 0) and (`p`.`id` = `z`.`id_product`) and (`o`.`id` = `z`.`id_order`))),0)) AS `spolu_nakup`,(coalesce((select round(coalesce(sum((`x`.`quantity_kg` * `z`.`price_sale`)),0),2) from ((`order_item` `z` left join `order_subitem` `x` on(((`x`.`id_product` = `z`.`id_product`) and (`z`.`id_order` = `x`.`id_order`)))) join `color` `y` on(((`y`.`id` = `x`.`id_color`) and (`y`.`color_type` = 2)))) where (`o`.`id` = `z`.`id_order`)),0) + coalesce((select round(coalesce(sum((`z`.`quantity` * `z`.`price_sale`)),0),2) from `order_item` `z` where (`z`.`id_order` = `o`.`id`)),0)) AS `spolu_predaj` from ((((`order` `o` join `customer` `c` on((`o`.`id_customer` = `c`.`id`))) left join `user` `u` on((`o`.`id_user` = `u`.`id_user`))) left join `order_item` `i` on((`i`.`id_order` = `o`.`id`))) left join `order_subitem` `si` on(((`si`.`id_product` = `i`.`id_product`) and (`si`.`id_order` = `i`.`id_order`)))) group by `o`.`id`